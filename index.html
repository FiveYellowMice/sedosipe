<!DOCTYPE html>
<html lang="{{ lang }}">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>sedosipE</title>
		<meta name="description" content="{{ description }}">

		<meta name="theme-color" content="#3F51B5">

		<script>
			if (!window.Promise) document.write("<script src=\"{{ baseurl }}/bower_components/es6-promise-polyfill/promise.min.js\"><\/script>");
			if (!window.TextEncoder && !window.TextDecoder) {
				document.write("<script src=\"{{ baseurl }}/bower_components/text-encoding/lib/encoding-indexes.js\"><\/script>");
				document.write("<script src=\"{{ baseurl }}/bower_components/text-encoding/lib/encoding-.js\"><\/script>");
			}
		</script>

		<style>
			html, body,
			p, div, img,
			h1, h2, h3, h4, h5, h6,
			ul, ol, li {
				margin: 0;
				padding: 0;
				border: none;
			}

			body {
				font-family: "WenQuanYi Zen Hei", "Microsoft YaHei", sans-serif;
			}

			.preload {
				display: -webkit-flex;
				display: flex;
				-webkit-align-items: center;
				align-items: center;

				box-sizing: border-box;
				height: 100vh;
				width: 100%;
				position: fixed;
				top: 0;
				left: 0;
				z-index: 6;

				padding: 24px;

				background: #3F51B5;
			}

			.preload-loading-indicator {
				margin: auto;
				display: -webkit-flex;
				display: flex;
				-webkit-align-items: center;
				align-items: center;
				-webkit-justify-content: space-around;
				justify-content: space-around;
				flex-grow: 1;
				height: 48px;
			}

			.preload-loading-dot {
				width: 12px;
				height: 12px;
				background: #5C6BC0;
				border-radius: 100%;
			}

			.preload-loading-dot-active {
				background: #E8EAF6;
			}

			.notice {
				font-size: 2em;
				margin: auto;
				text-align: center;
				color: white;
			}
		</style>
	</head>

	<body>
		<div class="preload">
			<noscript><div class="no-js-notice notice">
				<p>{{ noJsNotice }}</p>
			</div></noscript>

			<div class="loading-notice notice" style="display: none;">
				<p>{{ loading }}</p>
			</div>

			<script>
			document.addEventListener("DOMContentLoaded", function() {
				var div = document.getElementsByClassName("loading-notice")[0];
				div.style.display = ""; // Show loading div

				var indicator = document.createElement("div")
				indicator.className = "preload-loading-indicator";
				var dots = Array.apply(null, Array(3)).map(function() {
					var el = document.createElement("div");
					el.className = "preload-loading-dot";
					indicator.appendChild(el);
					return el;
				}); // An array of dots
				div.appendChild(indicator);

				// Loading animation
				var round = 0;
				var animationId = setInterval(function() {
					dots[round % 3].classList.add("preload-loading-dot-active");
					dots[(round + 2) % 3].classList.remove("preload-loading-dot-active");
					round++;
				}, 800);

				// Load massive JavaScripts
				Promise.all([
					require("{{ baseurl }}/js/sql.js"),
					require("{{ baseurl }}/bower_components/lodash/dist/lodash.min.js"),
					require("{{ baseurl }}/bower_components/jquery/dist/jquery.min.js")
						.then(function() { return require("{{ baseurl }}/bower_components/velocity/velocity.min.js"); }),
					require("{{ baseurl }}/js/main.js")
				]).then(function() { return sedosipe.doConstruction(); })
				.then(function() { clearInterval(animationId); });
			});

			function require(link) { return new Promise(function(resolve) {
				var el = document.createElement("script");
				document.getElementsByTagName("body")[0].appendChild(el);
				el.addEventListener("load", resolve);
				el.src = link;
			}); }
			</script>
		</div>
	</body>
</html>
